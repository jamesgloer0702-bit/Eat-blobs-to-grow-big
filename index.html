<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Eat Blobs – Single Player</title>
<style>
body { margin: 0; overflow: hidden; background: #111; }
#gameCanvas { display: block; margin: 0 auto; background: #000; }
#usernamePrompt {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    font-family: Arial; color: white;
}
#winMessage {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    font-family: Arial; color: gold; font-size: 60px; text-shadow: 2px 2px 10px #000;
    display: none;
}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="usernamePrompt">
    Enter Username: <input id="username" type="text">
    <button id="joinBtn">Join Game</button>
</div>
<div id="winMessage">YOU WON!</div>

<script>
// ==== SETTINGS ====
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const worldSize = 4000;
let cameraX = worldSize/2;
let cameraY = worldSize/2;
let zoom = 1;
let gameStarted = false;
let username = null;

let player = null;
let blobs = [];

// Input
const keys = {};
document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);

// ==== SPAWN BLOBS ====
function spawnBlobs(count = 80) {
    blobs = [];
    for (let i=0;i<count;i++) {
        blobs.push({
            x: Math.random()*worldSize,
            y: Math.random()*worldSize,
            size: Math.random()*70+10,
            color: "green"
        });
    }
}

// ==== JOIN GAME ====
document.getElementById('joinBtn').addEventListener('click', () => {
    username = document.getElementById('username').value || "Player";
    player = {
        x: worldSize/2,
        y: worldSize/2,
        size: 25,
        color: "cyan",
        username: username
    };
    spawnBlobs();
    document.getElementById('usernamePrompt').style.display = 'none';
    gameStarted = true;
    gameLoop();
});

// ==== GAME LOOP ====
function gameLoop() {
    if (!gameStarted) return;

    // Move player
    if (keys["w"]) player.y -= 4;
    if (keys["s"]) player.y += 4;
    if (keys["a"]) player.x -= 4;
    if (keys["d"]) player.x += 4;

    // Keep in bounds
    player.x = Math.max(0, Math.min(worldSize, player.x));
    player.y = Math.max(0, Math.min(worldSize, player.y));

    // Eat blobs
    blobs.forEach((blob,i)=>{
        const dx = player.x-blob.x;
        const dy = player.y-blob.y;
        const dist = Math.sqrt(dx*dx+dy*dy);
        if (dist<player.size+blob.size) {
            if (player.size > blob.size) {
                const growth = blob.size*0.1*(25/player.size);
                player.size += growth;
                // Respawn blob
                blobs[i] = {
                    x: Math.random()*worldSize,
                    y: Math.random()*worldSize,
                    size: Math.random()*70+10,
                    color: "green"
                };
            } else {
                alert("You tried to eat something bigger — YOU DIED!");
                location.reload();
            }
        }
        blob.color = (blob.size < player.size) ? "green" : "red";
    });

    // Win condition — 5000
    if (player.size >= 5000) {
        document.getElementById("winMessage").style.display = "block";
        return;
    }

    // Camera
    cameraX = player.x;
    cameraY = player.y;
    zoom = Math.max(0.3,1-player.size/5000);

    draw();
    requestAnimationFrame(gameLoop);
}

// ==== DRAW ====
function draw() {
    ctx.save();
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.translate(canvas.width/2, canvas.height/2);
    ctx.scale(zoom, zoom);
    ctx.translate(-cameraX, -cameraY);

    // Draw grey ground
    ctx.fillStyle = "#888"; // grey color
    ctx.fillRect(0, 0, worldSize, worldSize);

    // Draw blobs
    blobs.forEach(blob=>{
        ctx.beginPath();
        ctx.arc(blob.x,blob.y,blob.size,0,Math.PI*2);
        ctx.fillStyle = blob.color;
        ctx.fill();
        ctx.closePath();
    });

    // Draw player
    ctx.beginPath();
    ctx.arc(player.x,player.y,player.size,0,Math.PI*2);
    ctx.fillStyle = player.color;
    ctx.fill();
    ctx.closePath();

    // Draw username
    ctx.fillStyle = "white";
    ctx.font = "18px Arial";
    ctx.textAlign = "center";
    ctx.fillText(player.username, player.x, player.y - player.size - 5);

    ctx.restore();
}
</script>
</body>
</html>
